<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.8 Identificando los argumentos para STAN | Estimación de áreas pequeñas con el modelo multinomial</title>
  <meta name="description" content="Documentos con la descripción del proceso de compilación en R." />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="3.8 Identificando los argumentos para STAN | Estimación de áreas pequeñas con el modelo multinomial" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Documentos con la descripción del proceso de compilación en R." />
  <meta name="github-repo" content="psirusteam/HHS-Handbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.8 Identificando los argumentos para STAN | Estimación de áreas pequeñas con el modelo multinomial" />
  
  <meta name="twitter:description" content="Documentos con la descripción del proceso de compilación en R." />
  

<meta name="author" content="Andrés Gutiérrez, Stalyn Guerrero, Carolina Franco, Charlotte Taglioni" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="identificando-los-dominios-para-realizar-estimación-del-modelo.html"/>
<link rel="next" href="validación-sobre-los-resultados-del-modelo-de-área..html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Estimación de áreas pequeñas con el modelo multinomial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prefacio</a></li>
<li class="chapter" data-level="1" data-path="estimación-directa-para-las-comunas-de-chile..html"><a href="estimación-directa-para-las-comunas-de-chile..html"><i class="fa fa-check"></i><b>1</b> Estimación directa para las comunas de Chile.</a>
<ul>
<li class="chapter" data-level="1.1" data-path="lectura-de-la-encuesta..html"><a href="lectura-de-la-encuesta..html"><i class="fa fa-check"></i><b>1.1</b> Lectura de la encuesta.</a></li>
<li class="chapter" data-level="1.2" data-path="definición-del-diseño-muestral.html"><a href="definición-del-diseño-muestral.html"><i class="fa fa-check"></i><b>1.2</b> Definición del diseño muestral</a></li>
<li class="chapter" data-level="1.3" data-path="estimación-directa-del-indicador.html"><a href="estimación-directa-del-indicador.html"><i class="fa fa-check"></i><b>1.3</b> Estimación directa del indicador</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="análisis-descriptivo-de-las-estimaciones-directas..html"><a href="análisis-descriptivo-de-las-estimaciones-directas..html"><i class="fa fa-check"></i><b>2</b> Análisis descriptivo de las estimaciones directas.</a>
<ul>
<li class="chapter" data-level="2.1" data-path="lectura-de-librerías.html"><a href="lectura-de-librerías.html"><i class="fa fa-check"></i><b>2.1</b> Lectura de librerías</a></li>
<li class="chapter" data-level="2.2" data-path="definiendo-algunas-funciones..html"><a href="definiendo-algunas-funciones..html"><i class="fa fa-check"></i><b>2.2</b> Definiendo algunas funciones.</a></li>
<li class="chapter" data-level="2.3" data-path="lectura-de-las-estimaciones-directas.html"><a href="lectura-de-las-estimaciones-directas.html"><i class="fa fa-check"></i><b>2.3</b> Lectura de las estimaciones directas</a></li>
<li class="chapter" data-level="2.4" data-path="descriptivo-de-las-estimaciones-directas.html"><a href="descriptivo-de-las-estimaciones-directas.html"><i class="fa fa-check"></i><b>2.4</b> Descriptivo de las estimaciones directas</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="descriptivo-de-las-estimaciones-directas.html"><a href="descriptivo-de-las-estimaciones-directas.html#conteo-de-los-dominios-con-deff-no-estimados"><i class="fa fa-check"></i><b>2.4.1</b> Conteo de los dominios con deff no estimados</a></li>
<li class="chapter" data-level="2.4.2" data-path="descriptivo-de-las-estimaciones-directas.html"><a href="descriptivo-de-las-estimaciones-directas.html#conteo-de-los-dominios-con-deff-mayores-que-1"><i class="fa fa-check"></i><b>2.4.2</b> Conteo de los dominios con deff mayores que 1</a></li>
<li class="chapter" data-level="2.4.3" data-path="descriptivo-de-las-estimaciones-directas.html"><a href="descriptivo-de-las-estimaciones-directas.html#porcentaje-de-dominios-con-estimación-de-la-varianza-mayor-a-0"><i class="fa fa-check"></i><b>2.4.3</b> Porcentaje de dominios con estimación de la varianza mayor a 0</a></li>
<li class="chapter" data-level="2.4.4" data-path="descriptivo-de-las-estimaciones-directas.html"><a href="descriptivo-de-las-estimaciones-directas.html#conteo-de-dominios-con-dos-o-más-upm-y-deff-mayor-1-simultáneamente."><i class="fa fa-check"></i><b>2.4.4</b> Conteo de dominios con dos o más upm y deff mayor 1 simultáneamente.</a></li>
<li class="chapter" data-level="2.4.5" data-path="descriptivo-de-las-estimaciones-directas.html"><a href="descriptivo-de-las-estimaciones-directas.html#selección-de-los-dominios-que-empleamos-en-el-modelo-de-área."><i class="fa fa-check"></i><b>2.4.5</b> Selección de los dominios que empleamos en el modelo de área.</a></li>
<li class="chapter" data-level="2.4.6" data-path="descriptivo-de-las-estimaciones-directas.html"><a href="descriptivo-de-las-estimaciones-directas.html#guardar-archivos"><i class="fa fa-check"></i><b>2.4.6</b> Guardar archivos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="estimación-del-modelo-de-área-de-respuesta-multinomial.html"><a href="estimación-del-modelo-de-área-de-respuesta-multinomial.html"><i class="fa fa-check"></i><b>3</b> Estimación del modelo de área de respuesta multinomial</a>
<ul>
<li class="chapter" data-level="3.1" data-path="lectura-de-librerías-1.html"><a href="lectura-de-librerías-1.html"><i class="fa fa-check"></i><b>3.1</b> Lectura de librerías</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="lectura-de-librerías-1.html"><a href="lectura-de-librerías-1.html#lectura-de-bases-de-datos"><i class="fa fa-check"></i><b>3.1.1</b> Lectura de bases de datos</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="realizando-ajuste-sobre-el-deff-estimado..html"><a href="realizando-ajuste-sobre-el-deff-estimado..html"><i class="fa fa-check"></i><b>3.2</b> Realizando ajuste sobre el deff estimado.</a></li>
<li class="chapter" data-level="3.3" data-path="definición-del-modelo-multinomial.html"><a href="definición-del-modelo-multinomial.html"><i class="fa fa-check"></i><b>3.3</b> Definición del modelo multinomial</a></li>
<li class="chapter" data-level="3.4" data-path="modelo-programando-en-stan.html"><a href="modelo-programando-en-stan.html"><i class="fa fa-check"></i><b>3.4</b> Modelo programando en <code>STAN</code></a></li>
<li class="chapter" data-level="3.5" data-path="identificando-los-municipios-para-predicción.html"><a href="identificando-los-municipios-para-predicción.html"><i class="fa fa-check"></i><b>3.5</b> Identificando los municipios para predicción</a></li>
<li class="chapter" data-level="3.6" data-path="obteniendo-la-matriz.html"><a href="obteniendo-la-matriz.html"><i class="fa fa-check"></i><b>3.6</b> Obteniendo la matriz</a></li>
<li class="chapter" data-level="3.7" data-path="identificando-los-dominios-para-realizar-estimación-del-modelo.html"><a href="identificando-los-dominios-para-realizar-estimación-del-modelo.html"><i class="fa fa-check"></i><b>3.7</b> Identificando los dominios para realizar estimación del modelo</a></li>
<li class="chapter" data-level="3.8" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html"><i class="fa fa-check"></i><b>3.8</b> Identificando los argumentos para <code>STAN</code></a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html#preparando-argumentos-para-stan"><i class="fa fa-check"></i><b>3.8.1</b> Preparando argumentos para <code>STAN</code></a></li>
<li class="chapter" data-level="3.8.2" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html#ejecutando-el-modelo-en-stan"><i class="fa fa-check"></i><b>3.8.2</b> Ejecutando el modelo en <code>STAN</code></a></li>
<li class="chapter" data-level="3.8.3" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html#valores-estimados-para-beta"><i class="fa fa-check"></i><b>3.8.3</b> Valores estimados para beta</a></li>
<li class="chapter" data-level="3.8.4" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html#valores-estimados-para-la-matriz-de-correlación"><i class="fa fa-check"></i><b>3.8.4</b> Valores estimados para la matriz de correlación</a></li>
<li class="chapter" data-level="3.8.5" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html#validación-dela-convergencia-de-las-cadenas"><i class="fa fa-check"></i><b>3.8.5</b> Validación dela convergencia de las cadenas</a></li>
<li class="chapter" data-level="3.8.6" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html#evaluación-visual-de-las-cadenas-para-beta"><i class="fa fa-check"></i><b>3.8.6</b> Evaluación visual de las cadenas para beta</a></li>
<li class="chapter" data-level="3.8.7" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html#extrayendo-las-estimaciones-para-theta"><i class="fa fa-check"></i><b>3.8.7</b> extrayendo las estimaciones para theta</a></li>
<li class="chapter" data-level="3.8.8" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html#organizando-los-resultados-en-una-matriz."><i class="fa fa-check"></i><b>3.8.8</b> Organizando los resultados en una matriz.</a></li>
<li class="chapter" data-level="3.8.9" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html#preparando-el-gráfico-comparativo-entre-la-estimación-dir-y-el-modelo"><i class="fa fa-check"></i><b>3.8.9</b> Preparando el gráfico comparativo entre la estimación dir y el modelo</a></li>
<li class="chapter" data-level="3.8.10" data-path="identificando-los-argumentos-para-stan.html"><a href="identificando-los-argumentos-para-stan.html#preparando-el-ppc"><i class="fa fa-check"></i><b>3.8.10</b> Preparando el ppc</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="validación-sobre-los-resultados-del-modelo-de-área..html"><a href="validación-sobre-los-resultados-del-modelo-de-área..html"><i class="fa fa-check"></i><b>4</b> Validación sobre los resultados del modelo de área.</a>
<ul>
<li class="chapter" data-level="4.1" data-path="lectura-de-librerías-2.html"><a href="lectura-de-librerías-2.html"><i class="fa fa-check"></i><b>4.1</b> Lectura de librerías</a></li>
<li class="chapter" data-level="4.2" data-path="lectura-de-bases-de-datos-1.html"><a href="lectura-de-bases-de-datos-1.html"><i class="fa fa-check"></i><b>4.2</b> Lectura de bases de datos</a></li>
<li class="chapter" data-level="4.3" data-path="estimacion-directa.html"><a href="estimacion-directa.html"><i class="fa fa-check"></i><b>4.3</b> Estimacion directa</a></li>
<li class="chapter" data-level="4.4" data-path="estimación-del-coeficiente-de-variación.html"><a href="estimación-del-coeficiente-de-variación.html"><i class="fa fa-check"></i><b>4.4</b> Estimación del coeficiente de variación</a></li>
<li class="chapter" data-level="4.5" data-path="consolidando-los-resultados-en-una-base-de-datos..html"><a href="consolidando-los-resultados-en-una-base-de-datos..html"><i class="fa fa-check"></i><b>4.5</b> Consolidando los resultados en una base de datos.</a></li>
<li class="chapter" data-level="4.6" data-path="gráfica-comparativa-entre-las-estimación-directa-y-la-estimación-resultante-del-modelo.html"><a href="gráfica-comparativa-entre-las-estimación-directa-y-la-estimación-resultante-del-modelo.html"><i class="fa fa-check"></i><b>4.6</b> Gráfica comparativa entre las estimación directa y la estimación resultante del modelo</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="gráfica-comparativa-entre-las-estimación-directa-y-la-estimación-resultante-del-modelo.html"><a href="gráfica-comparativa-entre-las-estimación-directa-y-la-estimación-resultante-del-modelo.html#estimación-puntual"><i class="fa fa-check"></i><b>4.6.1</b> Estimación puntual</a></li>
<li class="chapter" data-level="4.6.2" data-path="gráfica-comparativa-entre-las-estimación-directa-y-la-estimación-resultante-del-modelo.html"><a href="gráfica-comparativa-entre-las-estimación-directa-y-la-estimación-resultante-del-modelo.html#error-estándar."><i class="fa fa-check"></i><b>4.6.2</b> Error estándar.</a></li>
<li class="chapter" data-level="4.6.3" data-path="gráfica-comparativa-entre-las-estimación-directa-y-la-estimación-resultante-del-modelo.html"><a href="gráfica-comparativa-entre-las-estimación-directa-y-la-estimación-resultante-del-modelo.html#coeficiente-de-varianción."><i class="fa fa-check"></i><b>4.6.3</b> Coeficiente de varianción.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="estimaciones-ajustadas-por-benchmark.html"><a href="estimaciones-ajustadas-por-benchmark.html"><i class="fa fa-check"></i><b>5</b> Estimaciones ajustadas por Benchmark</a>
<ul>
<li class="chapter" data-level="5.1" data-path="lectura-de-librerías-3.html"><a href="lectura-de-librerías-3.html"><i class="fa fa-check"></i><b>5.1</b> Lectura de librerías</a></li>
<li class="chapter" data-level="5.2" data-path="lectura-de-las-bases-de-datos.html"><a href="lectura-de-las-bases-de-datos.html"><i class="fa fa-check"></i><b>5.2</b> Lectura de las bases de datos</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="lectura-de-las-bases-de-datos.html"><a href="lectura-de-las-bases-de-datos.html#parametrizando-el-código"><i class="fa fa-check"></i><b>5.2.1</b> Parametrizando el código</a></li>
<li class="chapter" data-level="5.2.2" data-path="lectura-de-las-bases-de-datos.html"><a href="lectura-de-las-bases-de-datos.html#conteos-agregados-por-dam-y-dam2"><i class="fa fa-check"></i><b>5.2.2</b> Conteos agregados por dam y dam2</a></li>
<li class="chapter" data-level="5.2.3" data-path="lectura-de-las-bases-de-datos.html"><a href="lectura-de-las-bases-de-datos.html#tranformando-variables-de-la-encuesta."><i class="fa fa-check"></i><b>5.2.3</b> Tranformando variables de la encuesta.</a></li>
<li class="chapter" data-level="5.2.4" data-path="lectura-de-las-bases-de-datos.html"><a href="lectura-de-las-bases-de-datos.html#creando-el-objeto-diseño"><i class="fa fa-check"></i><b>5.2.4</b> Creando el objeto diseño</a></li>
<li class="chapter" data-level="5.2.5" data-path="lectura-de-las-bases-de-datos.html"><a href="lectura-de-las-bases-de-datos.html#estimado-el-indicador"><i class="fa fa-check"></i><b>5.2.5</b> Estimado el indicador</a></li>
<li class="chapter" data-level="5.2.6" data-path="lectura-de-las-bases-de-datos.html"><a href="lectura-de-las-bases-de-datos.html#organizando-las-estimaciones-directas-agregadas."><i class="fa fa-check"></i><b>5.2.6</b> Organizando las estimaciones directas agregadas.</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="benchmarking.html"><a href="benchmarking.html"><i class="fa fa-check"></i><b>5.3</b> Benchmarking</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="benchmarking.html"><a href="benchmarking.html#seleccionado-variables"><i class="fa fa-check"></i><b>5.3.1</b> Seleccionado variables</a></li>
<li class="chapter" data-level="5.3.2" data-path="benchmarking.html"><a href="benchmarking.html#creando-las-dummys"><i class="fa fa-check"></i><b>5.3.2</b> Creando las dummys</a></li>
<li class="chapter" data-level="5.3.3" data-path="benchmarking.html"><a href="benchmarking.html#obtenideno-los-ponderadores"><i class="fa fa-check"></i><b>5.3.3</b> Obtenideno los ponderadores</a></li>
<li class="chapter" data-level="5.3.4" data-path="benchmarking.html"><a href="benchmarking.html#creando-las-estimaciones-benchmark"><i class="fa fa-check"></i><b>5.3.4</b> Creando las estimaciones Benchmark</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="validación-visual-del-benchmark.html"><a href="validación-visual-del-benchmark.html"><i class="fa fa-check"></i><b>6</b> Validación visual del Benchmark</a>
<ul>
<li class="chapter" data-level="6.1" data-path="lectura-de-librerias.html"><a href="lectura-de-librerias.html"><i class="fa fa-check"></i><b>6.1</b> Lectura de librerias</a></li>
<li class="chapter" data-level="6.2" data-path="lectura-de-encuesta..html"><a href="lectura-de-encuesta..html"><i class="fa fa-check"></i><b>6.2</b> Lectura de encuesta.</a></li>
<li class="chapter" data-level="6.3" data-path="estimación-agregada.html"><a href="estimación-agregada.html"><i class="fa fa-check"></i><b>6.3</b> Estimación agregada</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="estimación-agregada.html"><a href="estimación-agregada.html#creación-de-objeto-diseno"><i class="fa fa-check"></i><b>6.3.1</b> Creación de objeto diseno</a></li>
<li class="chapter" data-level="6.3.2" data-path="estimación-agregada.html"><a href="estimación-agregada.html#estimación-del-indicador"><i class="fa fa-check"></i><b>6.3.2</b> Estimación del indicador</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="gráfica-de-validación.html"><a href="gráfica-de-validación.html"><i class="fa fa-check"></i><b>6.4</b> Gráfica de validación</a>
<ul>
<li class="chapter" data-level="" data-path="gráfica-de-validación.html"><a href="gráfica-de-validación.html#ocupado-1"><i class="fa fa-check"></i>Ocupado</a></li>
<li class="chapter" data-level="" data-path="gráfica-de-validación.html"><a href="gráfica-de-validación.html#desocupado-1"><i class="fa fa-check"></i>Desocupado</a></li>
<li class="chapter" data-level="" data-path="gráfica-de-validación.html"><a href="gráfica-de-validación.html#inactivo-1"><i class="fa fa-check"></i>Inactivo</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mapas-de-resultados.html"><a href="mapas-de-resultados.html"><i class="fa fa-check"></i><b>7</b> Mapas de resultados</a>
<ul>
<li class="chapter" data-level="7.1" data-path="lectura-de-librerías-4.html"><a href="lectura-de-librerías-4.html"><i class="fa fa-check"></i><b>7.1</b> Lectura de librerías</a></li>
<li class="chapter" data-level="7.2" data-path="parametrizando-el-código-1.html"><a href="parametrizando-el-código-1.html"><i class="fa fa-check"></i><b>7.2</b> Parametrizando el código</a></li>
<li class="chapter" data-level="7.3" data-path="lectura-de-shapefile.html"><a href="lectura-de-shapefile.html"><i class="fa fa-check"></i><b>7.3</b> Lectura de shapefile</a></li>
<li class="chapter" data-level="7.4" data-path="definición-del-mapa-con-tmap.html"><a href="definición-del-mapa-con-tmap.html"><i class="fa fa-check"></i><b>7.4</b> Definición del mapa con <code>tmap</code></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="definición-del-mapa-con-tmap.html"><a href="definición-del-mapa-con-tmap.html#creando-mapa-de-ocupados"><i class="fa fa-check"></i><b>7.4.1</b> Creando mapa de ocupados</a></li>
<li class="chapter" data-level="7.4.2" data-path="definición-del-mapa-con-tmap.html"><a href="definición-del-mapa-con-tmap.html#creando-mapa-de-desocupados"><i class="fa fa-check"></i><b>7.4.2</b> Creando mapa de desocupados</a></li>
<li class="chapter" data-level="7.4.3" data-path="definición-del-mapa-con-tmap.html"><a href="definición-del-mapa-con-tmap.html#creando-mapa-de-inactivo"><i class="fa fa-check"></i><b>7.4.3</b> Creando mapa de inactivo</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="país-colombia..html"><a href="país-colombia..html"><i class="fa fa-check"></i><b>8</b> País: Colombia.</a>
<ul>
<li class="chapter" data-level="8.1" data-path="lectura-de-la-encuesta-y-estimaciones-directas.html"><a href="lectura-de-la-encuesta-y-estimaciones-directas.html"><i class="fa fa-check"></i><b>8.1</b> Lectura de la encuesta y estimaciones directas</a></li>
<li class="chapter" data-level="8.2" data-path="selección-de-dominios.html"><a href="selección-de-dominios.html"><i class="fa fa-check"></i><b>8.2</b> Selección de dominios</a></li>
<li class="chapter" data-level="8.3" data-path="preparando-insumos-para-stan.html"><a href="preparando-insumos-para-stan.html"><i class="fa fa-check"></i><b>8.3</b> Preparando insumos para <code>STAN</code></a></li>
<li class="chapter" data-level="8.4" data-path="validación-del-modelo.html"><a href="validación-del-modelo.html"><i class="fa fa-check"></i><b>8.4</b> Validación del modelo</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="validación-del-modelo.html"><a href="validación-del-modelo.html#estimación-de-los-parámetros."><i class="fa fa-check"></i><b>8.4.1</b> Estimación de los parámetros.</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="metodología-de-benchmarking.html"><a href="metodología-de-benchmarking.html"><i class="fa fa-check"></i><b>8.5</b> Metodología de Benchmarking</a></li>
<li class="chapter" data-level="8.6" data-path="mapas-del-mercado-de-trabajo..html"><a href="mapas-del-mercado-de-trabajo..html"><i class="fa fa-check"></i><b>8.6</b> Mapas del mercado de trabajo.</a>
<ul>
<li class="chapter" data-level="" data-path="mapas-del-mercado-de-trabajo..html"><a href="mapas-del-mercado-de-trabajo..html#ocupado-3"><i class="fa fa-check"></i>Ocupado</a></li>
<li class="chapter" data-level="" data-path="mapas-del-mercado-de-trabajo..html"><a href="mapas-del-mercado-de-trabajo..html#desocupado-3"><i class="fa fa-check"></i>Desocupado</a></li>
<li class="chapter" data-level="" data-path="mapas-del-mercado-de-trabajo..html"><a href="mapas-del-mercado-de-trabajo..html#inactivo-3"><i class="fa fa-check"></i>Inactivo</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="país-perú..html"><a href="país-perú..html"><i class="fa fa-check"></i><b>9</b> País: Perú.</a>
<ul>
<li class="chapter" data-level="9.1" data-path="lectura-de-la-encuesta-y-estimaciones-directas-1.html"><a href="lectura-de-la-encuesta-y-estimaciones-directas-1.html"><i class="fa fa-check"></i><b>9.1</b> Lectura de la encuesta y estimaciones directas</a></li>
<li class="chapter" data-level="9.2" data-path="selección-de-dominios-1.html"><a href="selección-de-dominios-1.html"><i class="fa fa-check"></i><b>9.2</b> Selección de dominios</a></li>
<li class="chapter" data-level="9.3" data-path="preparando-insumos-para-stan-1.html"><a href="preparando-insumos-para-stan-1.html"><i class="fa fa-check"></i><b>9.3</b> Preparando insumos para <code>STAN</code></a></li>
<li class="chapter" data-level="9.4" data-path="validación-del-modelo-1.html"><a href="validación-del-modelo-1.html"><i class="fa fa-check"></i><b>9.4</b> Validación del modelo</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="validación-del-modelo-1.html"><a href="validación-del-modelo-1.html#estimación-de-los-parámetros.-1"><i class="fa fa-check"></i><b>9.4.1</b> Estimación de los parámetros.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="metodología-de-benchmarking-1.html"><a href="metodología-de-benchmarking-1.html"><i class="fa fa-check"></i><b>9.5</b> Metodología de Benchmarking</a></li>
<li class="chapter" data-level="9.6" data-path="mapas-del-mercado-de-trabajo.-1.html"><a href="mapas-del-mercado-de-trabajo.-1.html"><i class="fa fa-check"></i><b>9.6</b> Mapas del mercado de trabajo.</a>
<ul>
<li class="chapter" data-level="" data-path="mapas-del-mercado-de-trabajo.-1.html"><a href="mapas-del-mercado-de-trabajo.-1.html#ocupado-5"><i class="fa fa-check"></i>Ocupado</a></li>
<li class="chapter" data-level="" data-path="mapas-del-mercado-de-trabajo.-1.html"><a href="mapas-del-mercado-de-trabajo.-1.html#desocupado-5"><i class="fa fa-check"></i>Desocupado</a></li>
<li class="chapter" data-level="" data-path="mapas-del-mercado-de-trabajo.-1.html"><a href="mapas-del-mercado-de-trabajo.-1.html#inactivo-5"><i class="fa fa-check"></i>Inactivo</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a Estimación de áreas pequeñas con el modelo multinomial </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Estimación de áreas pequeñas con el modelo multinomial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="identificando-los-argumentos-para-stan" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> Identificando los argumentos para <code>STAN</code><a href="identificando-los-argumentos-para-stan.html#identificando-los-argumentos-para-stan" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Creando <span class="math inline">\(\tilde{y}\)</span>, <span class="math inline">\(\tilde{n}\)</span> y <span class="math inline">\(\hat{y}\)</span></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="identificando-los-argumentos-para-stan.html#cb31-1" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">nrow</span>(indicador_dam1)</span>
<span id="cb31-2"><a href="identificando-los-argumentos-para-stan.html#cb31-2" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co"># Ocupado, desocupado, inactivo.</span></span>
<span id="cb31-3"><a href="identificando-los-argumentos-para-stan.html#cb31-3" aria-hidden="true" tabindex="-1"></a>Y_tilde <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, D, P)</span>
<span id="cb31-4"><a href="identificando-los-argumentos-para-stan.html#cb31-4" aria-hidden="true" tabindex="-1"></a>n_tilde <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, D, P)</span>
<span id="cb31-5"><a href="identificando-los-argumentos-para-stan.html#cb31-5" aria-hidden="true" tabindex="-1"></a>Y_hat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, D, P)</span></code></pre></div>
<p>Realizando los calculos necesarios para cada categoria.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="identificando-los-argumentos-para-stan.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># n efectivos ocupado</span></span>
<span id="cb32-2"><a href="identificando-los-argumentos-para-stan.html#cb32-2" aria-hidden="true" tabindex="-1"></a>n_tilde[,<span class="dv">1</span>] <span class="ot">&lt;-</span> (indicador_dam1<span class="sc">$</span>Ocupado<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> indicador_dam1<span class="sc">$</span>Ocupado))<span class="sc">/</span>indicador_dam1<span class="sc">$</span>Ocupado_var</span>
<span id="cb32-3"><a href="identificando-los-argumentos-para-stan.html#cb32-3" aria-hidden="true" tabindex="-1"></a>Y_tilde[,<span class="dv">1</span>] <span class="ot">&lt;-</span> n_tilde[,<span class="dv">1</span>]<span class="sc">*</span> indicador_dam1<span class="sc">$</span>Ocupado</span>
<span id="cb32-4"><a href="identificando-los-argumentos-para-stan.html#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="identificando-los-argumentos-para-stan.html#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="identificando-los-argumentos-para-stan.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># n efectivos desocupado</span></span>
<span id="cb32-7"><a href="identificando-los-argumentos-para-stan.html#cb32-7" aria-hidden="true" tabindex="-1"></a>n_tilde[,<span class="dv">2</span>] <span class="ot">&lt;-</span> (indicador_dam1<span class="sc">$</span>Desocupado<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> indicador_dam1<span class="sc">$</span>Desocupado))<span class="sc">/</span>indicador_dam1<span class="sc">$</span>Desocupado_var</span>
<span id="cb32-8"><a href="identificando-los-argumentos-para-stan.html#cb32-8" aria-hidden="true" tabindex="-1"></a>Y_tilde[,<span class="dv">2</span>] <span class="ot">&lt;-</span> n_tilde[,<span class="dv">2</span>]<span class="sc">*</span> indicador_dam1<span class="sc">$</span>Desocupado</span>
<span id="cb32-9"><a href="identificando-los-argumentos-para-stan.html#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="identificando-los-argumentos-para-stan.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># n efectivos Inactivo</span></span>
<span id="cb32-11"><a href="identificando-los-argumentos-para-stan.html#cb32-11" aria-hidden="true" tabindex="-1"></a>n_tilde[,<span class="dv">3</span>] <span class="ot">&lt;-</span> (indicador_dam1<span class="sc">$</span>Inactivo<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> indicador_dam1<span class="sc">$</span>Inactivo))<span class="sc">/</span>indicador_dam1<span class="sc">$</span>Inactivo_var</span>
<span id="cb32-12"><a href="identificando-los-argumentos-para-stan.html#cb32-12" aria-hidden="true" tabindex="-1"></a>Y_tilde[,<span class="dv">3</span>] <span class="ot">&lt;-</span> n_tilde[,<span class="dv">3</span>]<span class="sc">*</span> indicador_dam1<span class="sc">$</span>Inactivo</span></code></pre></div>
<p>Calculando <span class="math inline">\(\hat{y}\)</span></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="identificando-los-argumentos-para-stan.html#cb33-1" aria-hidden="true" tabindex="-1"></a>ni_hat <span class="ot">=</span> <span class="fu">rowSums</span>(Y_tilde)</span>
<span id="cb33-2"><a href="identificando-los-argumentos-para-stan.html#cb33-2" aria-hidden="true" tabindex="-1"></a>Y_hat[,<span class="dv">1</span>] <span class="ot">&lt;-</span> ni_hat<span class="sc">*</span> indicador_dam1<span class="sc">$</span>Ocupado</span>
<span id="cb33-3"><a href="identificando-los-argumentos-para-stan.html#cb33-3" aria-hidden="true" tabindex="-1"></a>Y_hat[,<span class="dv">2</span>] <span class="ot">&lt;-</span> ni_hat<span class="sc">*</span> indicador_dam1<span class="sc">$</span>Desocupado</span>
<span id="cb33-4"><a href="identificando-los-argumentos-para-stan.html#cb33-4" aria-hidden="true" tabindex="-1"></a>Y_hat[,<span class="dv">3</span>] <span class="ot">&lt;-</span> ni_hat<span class="sc">*</span> indicador_dam1<span class="sc">$</span>Inactivo</span></code></pre></div>
<p>Para realizar la validación de los calculos construimos el siguiente gráfico.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="identificando-los-argumentos-para-stan.html#cb34-1" aria-hidden="true" tabindex="-1"></a>hat_p <span class="ot">&lt;-</span> Y_hat<span class="sc">/</span><span class="fu">rowSums</span>(Y_hat)</span>
<span id="cb34-2"><a href="identificando-los-argumentos-para-stan.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb34-3"><a href="identificando-los-argumentos-para-stan.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hat_p[,<span class="dv">1</span>],indicador_dam1<span class="sc">$</span>Ocupado, <span class="at">main =</span> <span class="st">&quot;Ocupado&quot;</span>, </span>
<span id="cb34-4"><a href="identificando-los-argumentos-para-stan.html#cb34-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span>  <span class="st">&quot;hat_p&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Estimacion directa&quot;</span>)</span></code></pre></div>
<pre><code>## Error : The fig.showtext code chunk option must be TRUE</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="identificando-los-argumentos-para-stan.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hat_p[,<span class="dv">2</span>],indicador_dam1<span class="sc">$</span>Desocupado, </span>
<span id="cb36-2"><a href="identificando-los-argumentos-para-stan.html#cb36-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Desocupado&quot;</span>, </span>
<span id="cb36-3"><a href="identificando-los-argumentos-para-stan.html#cb36-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span>  <span class="st">&quot;hat_p&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Estimacion directa&quot;</span>)</span></code></pre></div>
<pre><code>## Error : The fig.showtext code chunk option must be TRUE</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="identificando-los-argumentos-para-stan.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hat_p[,<span class="dv">3</span>],indicador_dam1<span class="sc">$</span>Inactivo,<span class="at">main =</span> <span class="st">&quot;Inactivo&quot;</span>, </span>
<span id="cb38-2"><a href="identificando-los-argumentos-para-stan.html#cb38-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span>  <span class="st">&quot;hat_p&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Estimacion directa&quot;</span>)</span></code></pre></div>
<pre><code>## Error : The fig.showtext code chunk option must be TRUE</code></pre>
<p><img src="Estimaci%C3%B3n-de-%C3%A1reas-peque%C3%B1as-con-el-modelo-multinomial_files/figure-html/unnamed-chunk-36-1.svg" width="672" /></p>
<p>ahora, la correlación de las covariables y las estimaciones directas</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="identificando-los-argumentos-para-stan.html#cb40-1" aria-hidden="true" tabindex="-1"></a>rr <span class="ot">&lt;-</span> <span class="fu">cor</span>(hat_p,X_obs) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() </span>
<span id="cb40-2"><a href="identificando-los-argumentos-para-stan.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(rr)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ocupado&quot;</span>, <span class="st">&quot;Desocupado&quot;</span>, <span class="st">&quot;Inactivo&quot;</span>)</span>
<span id="cb40-3"><a href="identificando-los-argumentos-para-stan.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(rr)</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
luces_nocturnas
</th>
<th style="text-align:right;">
cubrimiento_cultivo
</th>
<th style="text-align:right;">
cubrimiento_urbano
</th>
<th style="text-align:right;">
modificacion_humana
</th>
<th style="text-align:right;">
accesibilidad_hospitales
</th>
<th style="text-align:right;">
accesibilidad_hosp_caminado
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Ocupado
</td>
<td style="text-align:right;">
0.4920
</td>
<td style="text-align:right;">
-0.1208
</td>
<td style="text-align:right;">
0.4485
</td>
<td style="text-align:right;">
0.2944
</td>
<td style="text-align:right;">
0.1127
</td>
<td style="text-align:right;">
0.0923
</td>
</tr>
<tr>
<td style="text-align:left;">
Desocupado
</td>
<td style="text-align:right;">
0.1402
</td>
<td style="text-align:right;">
-0.1097
</td>
<td style="text-align:right;">
0.1098
</td>
<td style="text-align:right;">
0.1228
</td>
<td style="text-align:right;">
-0.0765
</td>
<td style="text-align:right;">
-0.0944
</td>
</tr>
<tr>
<td style="text-align:left;">
Inactivo
</td>
<td style="text-align:right;">
-0.5401
</td>
<td style="text-align:right;">
0.1550
</td>
<td style="text-align:right;">
-0.4869
</td>
<td style="text-align:right;">
-0.3347
</td>
<td style="text-align:right;">
-0.0915
</td>
<td style="text-align:right;">
-0.0655
</td>
</tr>
</tbody>
</table>
<p>Agregando el intercepto a la matriz de covariables</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="identificando-los-argumentos-para-stan.html#cb41-1" aria-hidden="true" tabindex="-1"></a>X1_obs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="dv">1</span>,<span class="at">nrow =</span> D,<span class="at">ncol =</span> <span class="dv">1</span>),X_obs)</span>
<span id="cb41-2"><a href="identificando-los-argumentos-para-stan.html#cb41-2" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="fu">ncol</span>(X1_obs)</span>
<span id="cb41-3"><a href="identificando-los-argumentos-para-stan.html#cb41-3" aria-hidden="true" tabindex="-1"></a>D1 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_pred)</span>
<span id="cb41-4"><a href="identificando-los-argumentos-para-stan.html#cb41-4" aria-hidden="true" tabindex="-1"></a>X1_pred <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="dv">1</span>,<span class="at">nrow =</span> D1,<span class="at">ncol =</span> <span class="dv">1</span>),X_pred)</span></code></pre></div>
<div id="preparando-argumentos-para-stan" class="section level3 hasAnchor" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> Preparando argumentos para <code>STAN</code><a href="identificando-los-argumentos-para-stan.html#preparando-argumentos-para-stan" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El código siguiente crea un objeto de lista llamado <code>sample_data</code> que contiene los datos necesarios para estimar el modelo de área de respuesta multinomial. La lista incluye el número total de dominios (<code>D</code>), el número de categorías (<code>P</code>), la cantidad de covariables (<code>K</code>), las estimaciones directas de las categorías en cada dominio (<code>hat_y</code>), la matriz de covariables de los dominios observados (<code>X_obs</code>), la matriz de covariables de los dominios no observados (<code>X_pred</code>) y el número de dominios no observados (<code>D1</code>). Este objeto de lista será utilizado posteriormente en la estimación del modelo utilizando la función <code>stan</code>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="identificando-los-argumentos-para-stan.html#cb42-1" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">D =</span> D,</span>
<span id="cb42-2"><a href="identificando-los-argumentos-para-stan.html#cb42-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">P =</span> P,</span>
<span id="cb42-3"><a href="identificando-los-argumentos-para-stan.html#cb42-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">K =</span> K,</span>
<span id="cb42-4"><a href="identificando-los-argumentos-para-stan.html#cb42-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">hat_y =</span> Y_hat,</span>
<span id="cb42-5"><a href="identificando-los-argumentos-para-stan.html#cb42-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">X_obs =</span> X1_obs,</span>
<span id="cb42-6"><a href="identificando-los-argumentos-para-stan.html#cb42-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">X_pred =</span> X1_pred,</span>
<span id="cb42-7"><a href="identificando-los-argumentos-para-stan.html#cb42-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">D1 =</span> D1)</span></code></pre></div>
</div>
<div id="ejecutando-el-modelo-en-stan" class="section level3 hasAnchor" number="3.8.2">
<h3><span class="header-section-number">3.8.2</span> Ejecutando el modelo en <code>STAN</code><a href="identificando-los-argumentos-para-stan.html#ejecutando-el-modelo-en-stan" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Este código ejecuta el muestreo MCMC utilizando el modelo especificado en <code>fit2</code>, con un número de iteraciones de muestreo y calentamiento de 2000 cada uno, y utilizando los datos en <code>sample_data</code>. También especifica una semilla de 123 para reproducibilidad y ejecuta cuatro cadenas paralelas en cuatro núcleos. El resultado es una lista <code>fit_mcmc2</code> que contiene los valores muestreados de los parámetros del modelo y otros diagnósticos del muestreo.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="identificando-los-argumentos-para-stan.html#cb43-1" aria-hidden="true" tabindex="-1"></a>fit_mcmc2 <span class="ot">&lt;-</span> <span class="fu">stan</span>(</span>
<span id="cb43-2"><a href="identificando-los-argumentos-para-stan.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;01 Modelo de area/0funciones/01 Multinomial_simple_pred.stan&quot;</span>,  <span class="co"># Stan program</span></span>
<span id="cb43-3"><a href="identificando-los-argumentos-para-stan.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sample_data,    <span class="co"># named list of data</span></span>
<span id="cb43-4"><a href="identificando-los-argumentos-para-stan.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  chains = 4,             # number of Markov chains</span></span>
<span id="cb43-5"><a href="identificando-los-argumentos-para-stan.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb43-6"><a href="identificando-los-argumentos-para-stan.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">warmup =</span> <span class="dv">2000</span>,          <span class="co"># number of warmup iterations per chain</span></span>
<span id="cb43-7"><a href="identificando-los-argumentos-para-stan.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,            <span class="co"># total number of iterations per chain</span></span>
<span id="cb43-8"><a href="identificando-los-argumentos-para-stan.html#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,              <span class="co"># number of cores (could use one per chain)</span></span>
<span id="cb43-9"><a href="identificando-los-argumentos-para-stan.html#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  refresh = 0             # no progress shown</span></span>
<span id="cb43-10"><a href="identificando-los-argumentos-para-stan.html#cb43-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Guardando el modelo</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="identificando-los-argumentos-para-stan.html#cb44-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">saveRDS</span>(fit_mcmc2,</span>
<span id="cb44-2"><a href="identificando-los-argumentos-para-stan.html#cb44-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;01 Modelo de area/CHL/2017/Data/fit_multinomial_con_covariable.Rds&quot;</span>)</span></code></pre></div>
<p>leer el modelo previamente ejecutado</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="identificando-los-argumentos-para-stan.html#cb45-1" aria-hidden="true" tabindex="-1"></a>fit_mcmc2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;01 Modelo de area/CHL/2017/Data/fit_multinomial_con_covariable.Rds&quot;</span>)</span></code></pre></div>
</div>
<div id="valores-estimados-para-beta" class="section level3 hasAnchor" number="3.8.3">
<h3><span class="header-section-number">3.8.3</span> Valores estimados para beta<a href="identificando-los-argumentos-para-stan.html#valores-estimados-para-beta" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="identificando-los-argumentos-para-stan.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mcmc2, <span class="at">pars =</span> <span class="st">&quot;beta&quot;</span>)<span class="sc">$</span>summary <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="identificando-los-argumentos-para-stan.html#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
se_mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
2.5%
</th>
<th style="text-align:right;">
25%
</th>
<th style="text-align:right;">
50%
</th>
<th style="text-align:right;">
75%
</th>
<th style="text-align:right;">
97.5%
</th>
<th style="text-align:right;">
n_eff
</th>
<th style="text-align:right;">
Rhat
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
beta[1,1]
</td>
<td style="text-align:right;">
-3.2887
</td>
<td style="text-align:right;">
0.0026
</td>
<td style="text-align:right;">
0.1005
</td>
<td style="text-align:right;">
-3.4856
</td>
<td style="text-align:right;">
-3.3565
</td>
<td style="text-align:right;">
-3.2888
</td>
<td style="text-align:right;">
-3.2228
</td>
<td style="text-align:right;">
-3.0899
</td>
<td style="text-align:right;">
1550.456
</td>
<td style="text-align:right;">
1.0022
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[1,2]
</td>
<td style="text-align:right;">
-0.0324
</td>
<td style="text-align:right;">
0.0018
</td>
<td style="text-align:right;">
0.0749
</td>
<td style="text-align:right;">
-0.1792
</td>
<td style="text-align:right;">
-0.0827
</td>
<td style="text-align:right;">
-0.0328
</td>
<td style="text-align:right;">
0.0200
</td>
<td style="text-align:right;">
0.1124
</td>
<td style="text-align:right;">
1732.077
</td>
<td style="text-align:right;">
1.0018
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[1,3]
</td>
<td style="text-align:right;">
-0.1460
</td>
<td style="text-align:right;">
0.0011
</td>
<td style="text-align:right;">
0.0428
</td>
<td style="text-align:right;">
-0.2292
</td>
<td style="text-align:right;">
-0.1752
</td>
<td style="text-align:right;">
-0.1468
</td>
<td style="text-align:right;">
-0.1166
</td>
<td style="text-align:right;">
-0.0624
</td>
<td style="text-align:right;">
1459.259
</td>
<td style="text-align:right;">
1.0027
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[1,4]
</td>
<td style="text-align:right;">
-0.1329
</td>
<td style="text-align:right;">
0.0014
</td>
<td style="text-align:right;">
0.0633
</td>
<td style="text-align:right;">
-0.2567
</td>
<td style="text-align:right;">
-0.1755
</td>
<td style="text-align:right;">
-0.1335
</td>
<td style="text-align:right;">
-0.0906
</td>
<td style="text-align:right;">
-0.0073
</td>
<td style="text-align:right;">
1942.175
</td>
<td style="text-align:right;">
1.0018
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[1,5]
</td>
<td style="text-align:right;">
0.1987
</td>
<td style="text-align:right;">
0.0020
</td>
<td style="text-align:right;">
0.0727
</td>
<td style="text-align:right;">
0.0557
</td>
<td style="text-align:right;">
0.1489
</td>
<td style="text-align:right;">
0.1985
</td>
<td style="text-align:right;">
0.2490
</td>
<td style="text-align:right;">
0.3385
</td>
<td style="text-align:right;">
1385.171
</td>
<td style="text-align:right;">
1.0032
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[1,6]
</td>
<td style="text-align:right;">
12.2961
</td>
<td style="text-align:right;">
0.0346
</td>
<td style="text-align:right;">
1.3589
</td>
<td style="text-align:right;">
9.5827
</td>
<td style="text-align:right;">
11.4018
</td>
<td style="text-align:right;">
12.2943
</td>
<td style="text-align:right;">
13.1933
</td>
<td style="text-align:right;">
14.9532
</td>
<td style="text-align:right;">
1541.759
</td>
<td style="text-align:right;">
1.0021
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[2,1]
</td>
<td style="text-align:right;">
-0.4829
</td>
<td style="text-align:right;">
0.0016
</td>
<td style="text-align:right;">
0.0502
</td>
<td style="text-align:right;">
-0.5807
</td>
<td style="text-align:right;">
-0.5173
</td>
<td style="text-align:right;">
-0.4840
</td>
<td style="text-align:right;">
-0.4487
</td>
<td style="text-align:right;">
-0.3828
</td>
<td style="text-align:right;">
1009.085
</td>
<td style="text-align:right;">
1.0027
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[2,2]
</td>
<td style="text-align:right;">
-0.2249
</td>
<td style="text-align:right;">
0.0010
</td>
<td style="text-align:right;">
0.0375
</td>
<td style="text-align:right;">
-0.2991
</td>
<td style="text-align:right;">
-0.2496
</td>
<td style="text-align:right;">
-0.2247
</td>
<td style="text-align:right;">
-0.2001
</td>
<td style="text-align:right;">
-0.1492
</td>
<td style="text-align:right;">
1425.482
</td>
<td style="text-align:right;">
1.0021
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[2,3]
</td>
<td style="text-align:right;">
-0.0249
</td>
<td style="text-align:right;">
0.0006
</td>
<td style="text-align:right;">
0.0212
</td>
<td style="text-align:right;">
-0.0665
</td>
<td style="text-align:right;">
-0.0393
</td>
<td style="text-align:right;">
-0.0246
</td>
<td style="text-align:right;">
-0.0103
</td>
<td style="text-align:right;">
0.0165
</td>
<td style="text-align:right;">
1237.445
</td>
<td style="text-align:right;">
1.0026
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[2,4]
</td>
<td style="text-align:right;">
0.0041
</td>
<td style="text-align:right;">
0.0008
</td>
<td style="text-align:right;">
0.0309
</td>
<td style="text-align:right;">
-0.0570
</td>
<td style="text-align:right;">
-0.0170
</td>
<td style="text-align:right;">
0.0042
</td>
<td style="text-align:right;">
0.0253
</td>
<td style="text-align:right;">
0.0642
</td>
<td style="text-align:right;">
1682.866
</td>
<td style="text-align:right;">
1.0047
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[2,5]
</td>
<td style="text-align:right;">
0.1075
</td>
<td style="text-align:right;">
0.0011
</td>
<td style="text-align:right;">
0.0364
</td>
<td style="text-align:right;">
0.0372
</td>
<td style="text-align:right;">
0.0824
</td>
<td style="text-align:right;">
0.1074
</td>
<td style="text-align:right;">
0.1322
</td>
<td style="text-align:right;">
0.1789
</td>
<td style="text-align:right;">
1147.132
</td>
<td style="text-align:right;">
1.0009
</td>
</tr>
<tr>
<td style="text-align:left;">
beta[2,6]
</td>
<td style="text-align:right;">
4.8313
</td>
<td style="text-align:right;">
0.0212
</td>
<td style="text-align:right;">
0.6851
</td>
<td style="text-align:right;">
3.4469
</td>
<td style="text-align:right;">
4.3705
</td>
<td style="text-align:right;">
4.8426
</td>
<td style="text-align:right;">
5.3007
</td>
<td style="text-align:right;">
6.1660
</td>
<td style="text-align:right;">
1048.115
</td>
<td style="text-align:right;">
1.0027
</td>
</tr>
</tbody>
</table>
</div>
<div id="valores-estimados-para-la-matriz-de-correlación" class="section level3 hasAnchor" number="3.8.4">
<h3><span class="header-section-number">3.8.4</span> Valores estimados para la matriz de correlación<a href="identificando-los-argumentos-para-stan.html#valores-estimados-para-la-matriz-de-correlación" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="identificando-los-argumentos-para-stan.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mcmc2, <span class="at">pars =</span> <span class="st">&quot;Omega&quot;</span>)<span class="sc">$</span>summary <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="identificando-los-argumentos-para-stan.html#cb47-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
se_mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
2.5%
</th>
<th style="text-align:right;">
25%
</th>
<th style="text-align:right;">
50%
</th>
<th style="text-align:right;">
75%
</th>
<th style="text-align:right;">
97.5%
</th>
<th style="text-align:right;">
n_eff
</th>
<th style="text-align:right;">
Rhat
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Omega[1,1]
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
</tr>
<tr>
<td style="text-align:left;">
Omega[1,2]
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.0024
</td>
<td style="text-align:right;">
0.0723
</td>
<td style="text-align:right;">
0.0262
</td>
<td style="text-align:right;">
0.1222
</td>
<td style="text-align:right;">
0.1701
</td>
<td style="text-align:right;">
0.2194
</td>
<td style="text-align:right;">
0.3066
</td>
<td style="text-align:right;">
914.0926
</td>
<td style="text-align:right;">
1.0004
</td>
</tr>
<tr>
<td style="text-align:left;">
Omega[2,1]
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.0024
</td>
<td style="text-align:right;">
0.0723
</td>
<td style="text-align:right;">
0.0262
</td>
<td style="text-align:right;">
0.1222
</td>
<td style="text-align:right;">
0.1701
</td>
<td style="text-align:right;">
0.2194
</td>
<td style="text-align:right;">
0.3066
</td>
<td style="text-align:right;">
914.0926
</td>
<td style="text-align:right;">
1.0004
</td>
</tr>
<tr>
<td style="text-align:left;">
Omega[2,2]
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
7803.8115
</td>
<td style="text-align:right;">
0.9995
</td>
</tr>
</tbody>
</table>
</div>
<div id="validación-dela-convergencia-de-las-cadenas" class="section level3 hasAnchor" number="3.8.5">
<h3><span class="header-section-number">3.8.5</span> Validación dela convergencia de las cadenas<a href="identificando-los-argumentos-para-stan.html#validación-dela-convergencia-de-las-cadenas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>valores cercanos a 1 indica que las cadenas hicieron convergencia.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="identificando-los-argumentos-para-stan.html#cb48-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(fit_mcmc2)<span class="sc">$</span>summary)<span class="sc">$</span>Rhat</span>
<span id="cb48-2"><a href="identificando-los-argumentos-para-stan.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_rhat_hist</span>(a, <span class="at">bins =</span> <span class="dv">30</span>)</span></code></pre></div>
<p><img src="Rmd/CHL/Recursos/Rhat.png" width="200%" style="display: block; margin: auto;" /></p>
</div>
<div id="evaluación-visual-de-las-cadenas-para-beta" class="section level3 hasAnchor" number="3.8.6">
<h3><span class="header-section-number">3.8.6</span> Evaluación visual de las cadenas para beta<a href="identificando-los-argumentos-para-stan.html#evaluación-visual-de-las-cadenas-para-beta" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El código dado genera un gráfico de densidad (mcmc_dens_chains), un gráfico de áreas (mcmc_areas) y un gráfico de traza (mcmc_trace) para cada parámetro en la matriz “beta” en la salida del modelo de MCMC “fit_mcmc2”. Los gráficos de densidad y de áreas muestran la distribución posterior de cada parámetro en la matriz “beta” para cada cadena del modelo.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="identificando-los-argumentos-para-stan.html#cb49-1" aria-hidden="true" tabindex="-1"></a>posterior_beta <span class="ot">&lt;-</span> <span class="fu">as.array</span>(fit_mcmc2, <span class="at">pars =</span> <span class="st">&quot;beta&quot;</span>)</span>
<span id="cb49-2"><a href="identificando-los-argumentos-para-stan.html#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="identificando-los-argumentos-para-stan.html#cb49-3" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(posterior_beta) <span class="sc">+</span></span>
<span id="cb49-4"><a href="identificando-los-argumentos-para-stan.html#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mcmc_areas</span>(posterior_beta) ) <span class="sc">/</span> </span>
<span id="cb49-5"><a href="identificando-los-argumentos-para-stan.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(posterior_beta)</span></code></pre></div>
<p><img src="Rmd/CHL/Recursos/mcmc_dens_betas.png" width="200%" style="display: block; margin: auto;" /><img src="Rmd/CHL/Recursos/mcmc_area_betas.png" width="200%" style="display: block; margin: auto;" /><img src="Rmd/CHL/Recursos/mcmc_trace_betas.png" width="200%" style="display: block; margin: auto;" /></p>
</div>
<div id="extrayendo-las-estimaciones-para-theta" class="section level3 hasAnchor" number="3.8.7">
<h3><span class="header-section-number">3.8.7</span> extrayendo las estimaciones para theta<a href="identificando-los-argumentos-para-stan.html#extrayendo-las-estimaciones-para-theta" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="identificando-los-argumentos-para-stan.html#cb50-1" aria-hidden="true" tabindex="-1"></a>theta_temp <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit_mcmc2, <span class="at">pars =</span> <span class="st">&quot;theta&quot;</span>)<span class="sc">$</span>summary[, <span class="st">&quot;mean&quot;</span>]</span>
<span id="cb50-2"><a href="identificando-los-argumentos-para-stan.html#cb50-2" aria-hidden="true" tabindex="-1"></a>theta_temp_pred <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit_mcmc2, <span class="at">pars =</span> <span class="st">&quot;theta_pred&quot;</span>)<span class="sc">$</span>summary[, <span class="st">&quot;mean&quot;</span>]</span></code></pre></div>
</div>
<div id="organizando-los-resultados-en-una-matriz." class="section level3 hasAnchor" number="3.8.8">
<h3><span class="header-section-number">3.8.8</span> Organizando los resultados en una matriz.<a href="identificando-los-argumentos-para-stan.html#organizando-los-resultados-en-una-matriz." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La primera parte del código crea una matriz <code>theta_fh</code>” de dimensiones D x P, en la que se colocan los valores medios de <code>theta_temp</code>. Los argumentos <code>nrow</code> y <code>ncol</code> definen las filas y columnas de la matriz, mientras que <code>byrow</code> establece que los valores se colocan por columnas. Luego se utiliza la función <code>rowSums()</code> para sumar los valores por filas.</p>
<p>El segundo bloque de código es similar al primero, pero crea una matriz <code>theta_fh_pred</code> de dimensiones D1 x P, con los valores medios de <code>theta_temp_pred</code>. Luego se utiliza la función <code>rowSums</code> para sumar los valores por filas.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="identificando-los-argumentos-para-stan.html#cb51-1" aria-hidden="true" tabindex="-1"></a>theta_fh <span class="ot">&lt;-</span> <span class="fu">matrix</span>(theta_temp, <span class="at">nrow =</span> D,<span class="at">ncol =</span> P,<span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-2"><a href="identificando-los-argumentos-para-stan.html#cb51-2" aria-hidden="true" tabindex="-1"></a>theta_fh_pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(theta_temp_pred, <span class="at">nrow =</span> D1,<span class="at">ncol =</span> P,<span class="at">byrow =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="preparando-el-gráfico-comparativo-entre-la-estimación-dir-y-el-modelo" class="section level3 hasAnchor" number="3.8.9">
<h3><span class="header-section-number">3.8.9</span> Preparando el gráfico comparativo entre la estimación dir y el modelo<a href="identificando-los-argumentos-para-stan.html#preparando-el-gráfico-comparativo-entre-la-estimación-dir-y-el-modelo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="identificando-los-argumentos-para-stan.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb52-2"><a href="identificando-los-argumentos-para-stan.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(theta_fh[,<span class="dv">1</span>],indicador_dam1<span class="sc">$</span>Ocupado)</span>
<span id="cb52-3"><a href="identificando-los-argumentos-para-stan.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>,<span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb52-4"><a href="identificando-los-argumentos-para-stan.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(theta_fh[,<span class="dv">2</span>],indicador_dam1<span class="sc">$</span>Desocupado)</span>
<span id="cb52-5"><a href="identificando-los-argumentos-para-stan.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>,<span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb52-6"><a href="identificando-los-argumentos-para-stan.html#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(theta_fh[,<span class="dv">3</span>],indicador_dam1<span class="sc">$</span>Inactivo)</span>
<span id="cb52-7"><a href="identificando-los-argumentos-para-stan.html#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>,<span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="Rmd/CHL/Recursos/Dir_modelo.png" width="200%" style="display: block; margin: auto;" /></p>
</div>
<div id="preparando-el-ppc" class="section level3 hasAnchor" number="3.8.10">
<h3><span class="header-section-number">3.8.10</span> Preparando el ppc<a href="identificando-los-argumentos-para-stan.html#preparando-el-ppc" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En el siguiente código se utiliza para realizar una validación cruzada predictiva (PPC, por las siglas en inglés) en los datos de prueba. Primero, se extraen las muestras de la distribución posterior predictiva para las variables <span class="math inline">\(\theta\)</span> (<code>y_pred_B</code>). Luego, se seleccionan aleatoriamente 500 filas de <code>y_pred_B</code>. A continuación, se separan las columnas de <code>y_pred_B</code> correspondientes a cada categoría de ocupación (Ocupado, Desocupado, Inactivo) y se crean los vectores <code>y_pred1</code>, <code>y_pred2</code> y <code>y_pred3</code>, respectivamente. Finalmente, se utiliza la función <code>ppc_dens_overlay()</code> para graficar la densidad de las predicciones en cada categoría y compararlas con los datos observados correspondientes.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="identificando-los-argumentos-para-stan.html#cb53-1" aria-hidden="true" tabindex="-1"></a>posterior_theta <span class="ot">&lt;-</span> <span class="fu">as.array</span>(fit_mcmc2, <span class="at">pars =</span> <span class="st">&quot;theta&quot;</span>)</span>
<span id="cb53-2"><a href="identificando-los-argumentos-para-stan.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(posterior_theta)</span>
<span id="cb53-3"><a href="identificando-los-argumentos-para-stan.html#cb53-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">dim</span>(posterior_theta)[<span class="dv">1</span>], <span class="dv">50</span>)</span>
<span id="cb53-4"><a href="identificando-los-argumentos-para-stan.html#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="identificando-los-argumentos-para-stan.html#cb53-5" aria-hidden="true" tabindex="-1"></a>theta_1<span class="ot">&lt;-</span>  <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">&quot;1]&quot;</span>,<span class="at">x =</span> <span class="fu">dimnames</span>(posterior_theta)<span class="sc">$</span>parameters,<span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-6"><a href="identificando-los-argumentos-para-stan.html#cb53-6" aria-hidden="true" tabindex="-1"></a>theta_2<span class="ot">&lt;-</span>  <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">&quot;2]&quot;</span>,<span class="at">x =</span> <span class="fu">dimnames</span>(posterior_theta)<span class="sc">$</span>parameters,<span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-7"><a href="identificando-los-argumentos-para-stan.html#cb53-7" aria-hidden="true" tabindex="-1"></a>theta_3<span class="ot">&lt;-</span>  <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">&quot;3]&quot;</span>,<span class="at">x =</span> <span class="fu">dimnames</span>(posterior_theta)<span class="sc">$</span>parameters,<span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-8"><a href="identificando-los-argumentos-para-stan.html#cb53-8" aria-hidden="true" tabindex="-1"></a>y_pred1 <span class="ot">&lt;-</span> posterior_theta[rowsrandom, , theta_1 ]</span>
<span id="cb53-9"><a href="identificando-los-argumentos-para-stan.html#cb53-9" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> posterior_theta[rowsrandom, , theta_2 ]</span>
<span id="cb53-10"><a href="identificando-los-argumentos-para-stan.html#cb53-10" aria-hidden="true" tabindex="-1"></a>y_pred3 <span class="ot">&lt;-</span> posterior_theta[rowsrandom, , theta_3 ]</span>
<span id="cb53-11"><a href="identificando-los-argumentos-para-stan.html#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="identificando-los-argumentos-para-stan.html#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(indicador_dam1<span class="sc">$</span>Ocupado), <span class="fu">matrix</span>(y_pred1, <span class="at">ncol =</span> <span class="fu">length</span>(theta_1)))<span class="sc">/</span></span>
<span id="cb53-13"><a href="identificando-los-argumentos-para-stan.html#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(indicador_dam1<span class="sc">$</span>Desocupado), <span class="fu">matrix</span>(y_pred2, <span class="at">ncol =</span> <span class="fu">length</span>(theta_1)))<span class="sc">/</span></span>
<span id="cb53-14"><a href="identificando-los-argumentos-para-stan.html#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(indicador_dam1<span class="sc">$</span>Inactivo), <span class="fu">matrix</span>(y_pred3, <span class="at">ncol =</span> <span class="fu">length</span>(theta_1)))</span></code></pre></div>
<p><img src="Rmd/CHL/Recursos/ppc_theta.png" width="200%" style="display: block; margin: auto;" /></p>

<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="identificando-los-argumentos-para-stan.html#cb54-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">warning =</span> <span class="cn">FALSE</span>, </span>
<span id="cb54-2"><a href="identificando-los-argumentos-para-stan.html#cb54-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-3"><a href="identificando-los-argumentos-para-stan.html#cb54-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cache =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-4"><a href="identificando-los-argumentos-para-stan.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb54-5"><a href="identificando-los-argumentos-para-stan.html#cb54-5" aria-hidden="true" tabindex="-1"></a>tba <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, <span class="at">cap =</span> <span class="cn">NA</span>){</span>
<span id="cb54-6"><a href="identificando-los-argumentos-para-stan.html#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(dat,</span>
<span id="cb54-7"><a href="identificando-los-argumentos-para-stan.html#cb54-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">&quot;html&quot;</span>, <span class="at">digits =</span>  <span class="dv">4</span>,</span>
<span id="cb54-8"><a href="identificando-los-argumentos-para-stan.html#cb54-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> cap) <span class="sc">%&gt;%</span> </span>
<span id="cb54-9"><a href="identificando-los-argumentos-para-stan.html#cb54-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">&quot;striped&quot;</span>, <span class="at">full_width =</span> F)<span class="sc">%&gt;%</span></span>
<span id="cb54-10"><a href="identificando-los-argumentos-para-stan.html#cb54-10" aria-hidden="true" tabindex="-1"></a>         <span class="fu">kable_classic</span>(<span class="at">full_width =</span> F, <span class="at">html_font =</span> <span class="st">&quot;Arial Narrow&quot;</span>)</span>
<span id="cb54-11"><a href="identificando-los-argumentos-para-stan.html#cb54-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="identificando-los-dominios-para-realizar-estimación-del-modelo.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="validación-sobre-los-resultados-del-modelo-de-área..html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/psirusteam/SAEMultinomialMercadoLaboral/Rmd/CHL/03-EstimacionSAE_multinomial.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Estimación de áreas pequeñas con el modelo multinomial.pdf", "Estimación de áreas pequeñas con el modelo multinomial.epub", "Estimación de áreas pequeñas con el modelo multinomial.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"tconfig": null
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
